---
- name: ğŸ‰ FINAL SOC LAB DASHBOARD - DOCKER INSTALLED
  hosts: security_tools
  become: yes
  tasks:
    - name: Collect comprehensive status
      shell: |
        echo "=== $(hostname) ==="
        echo "ğŸ’¾ Disk: $(df -h / | awk 'NR==2 {print $5 " used (" $3 "/" $2 ")"}')"
        echo "ğŸ§  Memory: $(free -h | awk 'NR==2 {print $3 "/" $2 " (" $3*100/$2 "%)"}')"
        echo "ğŸ“Š Load: $(cat /proc/loadavg | cut -d' ' -f1-3)"
        echo "ğŸ³ Docker: $(docker --version | cut -d' ' -f3-5)"
        echo "ğŸ”§ Services:"
        
        # Docker status
        if systemctl is-active docker >/dev/null 2>&1; then
          CONTAINERS=$(docker ps -q 2>/dev/null | wc -l)
          echo "  ğŸ³ Docker: âœ… ($CONTAINERS containers running)"
        else
          echo "  ğŸ³ Docker: âŒ"
        fi
        
        # Wazuh status
        if systemctl is-active wazuh-agent >/dev/null 2>&1; then
          echo "  ğŸ“ˆ Wazuh Agent: âœ…"
        else
          echo "  ğŸ“ˆ Wazuh Agent: âŒ"
        fi
        
        # Splunk status  
        if systemctl is-active splunk >/dev/null 2>&1; then
          echo "  ğŸ“Š Splunk: âœ…"
        else
          echo "  ğŸ“Š Splunk: âŒ"
        fi
        
        echo "---"
      register: status_report
      changed_when: false

    - name: Display final dashboard
      debug:
        msg: "{{ status_report.stdout }}"
